<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="{{ url_for('static', filename='3rd_party/bootstrap.min.css') }}" rel="stylesheet"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='3rd_party/icons/bootstrap-icons.css') }}">
    <script src="{{ url_for('static', filename='3rd_party/jquery.min.js') }}"></script>
    <title>Machinaris</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    {% if blockchain_download_size %}
    <meta http-equiv="refresh" content="10">
    {% endif %}
</head>

<body>

    <main>
        <div class="container py-4">

            <div class="p-5 mb-4 bg-light rounded-5">
                <div class="container-fluid py-5">
                    <img src="{{ url_for('static', filename='machinaris.png') }}"
                        style="height:128px; width:128px; float:left; margin-left:50px" />
                    <div class="text-center" style="margin-top: 20px">
                        <div class="display-4">Welcome to Machinaris!</div>
                        <div style="margin-top: 20px">An easy-to-use WebUI for Chia™ plotting and farming.</div>
                    </div>
                    <br clear="all" />
                    <hr class="my-4">

                    <div>
                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                        {% for category, message in messages %}
                        {% if category == 'message' %}
                        <div class="alert alert-warning" role="alert">
                            {% else %}
                            <div class="alert alert-{{ category }}" role="alert">
                                {% endif %}
                                {{ message|safe }}
                            </div>
                            {% endfor %}
                            {% endif %}
                            {% endwith %}
                        </div>

                        {% if blockchain_download_size %}
                        <br />
                        <p style="text-center"><b>Blockchain Download Status: {{ blockchain_download_size }} so far...</b></p>
                        <br />
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
                                role="progressbar" aria-valuenow="{{download_percentage}}" aria-valuemin="0" aria-valuemax="100" 
                                style="width: {{download_percentage}}%"></div>
                        </div>
                        <br />
                        <br />

                        <p>On very first launch, the Chia blockchain database (~20 GB compressed) is being downloaded from
                        <a target="_blank" href="https://www.chia-database.com/">https://www.chia-database.com/</a>.  
                        At about 45 GB in uncompressed size (progress shown above), this will take a while.</p>

                        <p>However minutes of download now, will save you multiple days of blockchain syncing later. 
                            Please be patient!</p>

                        <br />
                        <br />
                        <br />
                        <br />
                        <br />
                        <br />
                        <br />
                        <br />

                        <p class="small">NOTE: If you would prefer to allow Chia to sync the blockchain over many days,
                            see the <a href="https://github.com/guydavis/machinaris/wiki/Keys#blockchain-initialization"
                                target="_blank">Wiki</a> for details. Similarly, you may instead
                                <a href="https://github.com/guydavis/machinaris/wiki/Keys#blockchain-import"
                                target="_blank">import your own blockchain</a> if you have one from a previous Chia install.
                        </p>

                        {% else %}

                        <p>To get started with Machinaris as a Chia™ fullnode, either import your existing
                            24-word
                            mnemonic seed phrase: </p>
                        <!-- Sample mnemonic to hint with, key long since thrown-away -->
                        <form id="main-form" method="POST">
                            <input class="form-control me-2" id="mnemonic" name="mnemonic" type="text"
                                placeholder="north divorce holiday whisper inquiry toy rare minute father ostrich surprise runway ill episode dance rather unaware concert sunset maid gather grain gift wire"
                                aria-label="Import Key">
                            <br />
                            <button class="btn btn-outline-success" type="submit" id="btnImport">Import Existing
                                Key</button>
                            <h3 style="padding-top: 25px;">OR</h3>

                            <p>You can generate a brand-new mnemonic phrase that will be written to this in-container
                                path: {{ key_paths[0] }}
                            </p>
                            <button class="btn btn-outline-success" type="submit" id="btnGenerate">Generate New
                                Key</button>
                        </form>

                        <br />
                        <br />
                        <br />
                        <br />
                        <br />
                        <br />
                        <br />
                        <br />

                        <p class="small">NOTE: If you would prefer to instead import your mnenmoic seed phrase yourself
                            at the command-line,
                            see the <a href="https://github.com/guydavis/machinaris/wiki/Keys"
                                target="_blank">Wiki</a> for details.</p>

                        {% endif %}
                    </div>
                </div>
            </div>
    </main>

    <script src="{{ url_for('static', filename='3rd_party/bootstrap.bundle.min.js') }}"></script>

    <script>
        $(document).ready(function () {
            $("#btnImport").click(function () {
                var mnemonic = $('#mnemonic').val().trim();
                if (!mnemonic) {
                    alert("Please provide a non-empty mnemonic seed phrase to import.");
                    return;
                }
                if (mnemonic.split(' ').length != 24) {
                    alert("Please exactly 24 words in the mnemonic seed phrase to import.");
                    return;
                }
                $(this).prop("disabled", true);
                $(this).html(
                    `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Importing...`
                );
                $('#main-form').append('<input type="hidden" id="action" name="action" value="import" />');
                $("#main-form").submit();
            });
        })
        $(document).ready(function () {
            $("#btnGenerate").click(function () {
                $(this).prop("disabled", true);
                $(this).html(
                    `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Generating...`
                );
                $('#main-form').append('<input type="hidden" id="action" name="action" value="generate" />');
                $("#main-form").submit();
            });
        })
    </script>

</body>

</html>
